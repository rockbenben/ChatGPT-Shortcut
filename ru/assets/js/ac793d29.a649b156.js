"use strict";(self.webpackChunkchatgpt_shortcut=self.webpackChunkchatgpt_shortcut||[]).push([["650"],{85103(e,r,s){s.d(r,{c:()=>a,O:()=>l});var i=s(74848),t=s(96540),o=s(67202);let a=(0,t.createContext)({userAuth:null,refreshUserAuth:()=>{},setUserAuth:()=>{},authLoading:!1});function l({children:e}){let[r,s]=(0,t.useState)(null),l="undefined"!=typeof window&&localStorage.getItem("auth_token"),[n,d]=(0,t.useState)(!!l),c=(0,t.useCallback)(async(e=!1)=>{if(!("undefined"!=typeof window&&localStorage.getItem("auth_token")))return void d(!1);e&&(0,o.clearMySpaceCache)(),(0,t.startTransition)(()=>d(!0));try{let e=await (0,o.xS)(),r=Array.isArray(e.customTags)?e.customTags:e.customTags?.definitions||[],i=(e.items||[]).filter(e=>null!=e.id&&void 0!==e.id||(console.warn("[AuthProvider] Filtered out invalid item with null ID:",e),!1)),a={...e,customTags:r,items:i,favorites:{id:e.favoriteId,loves:i.filter(e=>"favorite"===e.type&&"card"===e.source).map(e=>e.id),commLoves:i.filter(e=>"favorite"===e.type&&"community"===e.source).map(e=>e.id),customTags:{definitions:r,itemTags:e.customTags?.itemTags||{}}},userprompts:i.filter(e=>"prompt"===e.type&&"userprompt"===e.source).map(e=>({id:e.id,share:e.share??!1,updatedAt:e.updatedAt}))};(0,t.startTransition)(()=>s({data:a}))}catch(e){console.error("Failed to fetch user data:",e),(0,t.startTransition)(()=>s(null))}finally{(0,t.startTransition)(()=>d(!1))}},[]);(0,t.useEffect)(()=>{c()},[]);let h=(0,t.useMemo)(()=>({userAuth:r,setUserAuth:s,refreshUserAuth:c,authLoading:n}),[r,c,n]);return(0,i.jsx)(a.Provider,{value:h,children:e})}},45856(e,r,s){s.r(r),s.d(r,{default:()=>U});var i=s(74848),t=s(96540),o=s(30568),a=s(95310),l=s(21085),n=s(24301),d=s(71024),c=s(35710),h=s(89986),m=s(84073),x=s(47152),p=s(16370),u=s(36813),j=s(21751),y=s(52930),g=s(9643),A=s(68101),f=s(50400),w=s(55021),b=s(65232),T=s(66845),v=s(85489),P=s(53159),S=s(7710),k=s(46029),C=s(76164),B=s(20156),R=s(26385),z=s(61381),I=s(56304),E=s(51757),F=s(85103),M=s(91831),D=s(67202);let{Title:O,Text:$}=n.A,L=()=>{let{userAuth:e}=(0,t.useContext)(F.c),{message:r,modal:s}=d.A.useApp(),{token:n}=c.A.useToken(),[L,U]=(0,t.useState)(null),[q,G]=(0,t.useState)(!0),[_,H]=(0,t.useState)(!1),[J,N]=(0,t.useState)(!1),[V,W]=(0,t.useState)(""),[Y]=h.A.useForm(),[Z]=h.A.useForm(),K=(0,t.useCallback)(async()=>{G(!0);try{let e=await (0,M.n)();e&&(U(e.data),W(e.data.username))}catch(e){console.error("Failed to fetch user info:",e)}finally{G(!1)}},[]);(0,t.useEffect)(()=>{K()},[K]),(0,t.useEffect)(()=>{if(!q&&!L){let e=setTimeout(()=>{window.location.href="/"},2e3);return()=>clearTimeout(e)}},[q,L]);let Q=(0,t.useCallback)(async()=>{try{let s=e?.data?.items?.filter(e=>"prompt"===e.type)||[];if(0===s.length)return void r.warning((0,i.jsx)(o.A,{id:"message.export.noPrompts",children:"\u6682\u65E0\u63D0\u793A\u8BCD\u53EF\u5BFC\u51FA"}));let t=s.map(e=>e.id),a=await (0,D.oO)("userprompts",t),l={exportTime:new Date().toISOString(),totalCount:a.length,prompts:a.map(e=>({id:e.id,title:e.title,description:e.description,remark:e.remark||"",notes:e.notes||"",createdAt:e.createdAt,updatedAt:e.updatedAt,share:e.share}))},n=JSON.stringify(l,null,2),d=new Blob([n],{type:"application/json"}),c=URL.createObjectURL(d),h=document.createElement("a");h.href=c,h.download=`my-prompts-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(c),r.success((0,i.jsx)(o.A,{id:"message.export.success",children:"\u63D0\u793A\u8BCD\u5BFC\u51FA\u6210\u529F\uFF01"}))}catch(e){console.error("Export error:",e),r.error((0,i.jsx)(o.A,{id:"message.export.error",children:"\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"}))}},[e,r]),X=(0,t.useCallback)(async()=>{try{(0,D.Yd)(),(0,D.clearMySpaceCache)(),await K(),r.success((0,i.jsx)(o.A,{id:"message.cache.cleared",children:"\u7F13\u5B58\u5DF2\u6E05\u9664\uFF0C\u6570\u636E\u5DF2\u5237\u65B0"}))}catch(e){console.error("Clear cache error:",e),r.error((0,i.jsx)(o.A,{id:"message.cache.clearError",children:"\u6E05\u9664\u7F13\u5B58\u5931\u8D25"}))}},[K,r]),ee=async()=>{if(!V.trim())return void r.error("Username cannot be empty");if(V===L?.username)return void N(!1);H(!0);try{await (0,D.kZ)(V),await K(),r.success("Username updated successfully!"),N(!1)}catch(s){console.error("Error updating username:",s);let e=s?.response?.data?.error?.message||"Unknown error";r.error(`Failed to update username: ${e}`)}finally{H(!1)}},er=async e=>{H(!0);try{await (0,D.ec)(e),r.success((0,i.jsx)(o.A,{id:"message.success.passwordChanged",children:"\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"})),Y.resetFields()}catch(e){console.error("Error changing password:",e),r.error((0,i.jsx)(o.A,{id:"message.error.passwordChangeFailed",children:"\u5BC6\u7801\u4FEE\u6539\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"}))}finally{H(!1)}},es=async e=>{H(!0);try{await (0,D.BD)(e.email),r.success((0,i.jsx)(o.A,{id:"message.success.forgotPassword",children:"\u5BC6\u7801\u91CD\u7F6E\u90AE\u4EF6\u5DF2\u53D1\u9001\uFF01"})),Z.resetFields()}catch(e){console.error("Error sending forgot password email:",e),r.error((0,i.jsx)(o.A,{id:"message.error.forgotPassword",children:"\u53D1\u9001\u5BC6\u7801\u91CD\u7F6E\u90AE\u4EF6\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"}))}finally{H(!1)}};return q||!L?(0,i.jsx)(l.A,{title:(0,o.T)({id:"link.myAccount",message:"\u6211\u7684\u8D26\u6237"}),children:(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:(0,i.jsx)(m.A,{size:"large"})})}):(0,i.jsx)(l.A,{title:(0,o.T)({id:"link.myAccount",message:"\u6211\u7684\u8D26\u6237"}),children:(0,i.jsx)("main",{style:{minHeight:"calc(100vh - 60px)",padding:"24px 0"},children:(0,i.jsx)(x.A,{justify:"center",children:(0,i.jsx)(p.A,{xs:24,sm:22,md:20,lg:16,xl:14,children:(0,i.jsxs)(u.A,{orientation:"vertical",size:"large",style:{width:"100%"},children:[(0,i.jsx)(j.A,{style:{borderRadius:n.borderRadiusLG,border:`1px solid ${n.colorBorderSecondary}`,boxShadow:n.boxShadowTertiary},styles:{body:{padding:"12px 24px"}},children:(0,i.jsx)(y.A,{justify:"space-between",align:"center",children:(0,i.jsx)(g.A,{itemRender:(e,r,s,t)=>s.indexOf(e)!==s.length-1&&e.path?(0,i.jsx)(a.A,{to:e.path,style:{color:"var(--ifm-color-primary)"},children:e.title}):(0,i.jsx)("span",{children:e.title}),items:[{path:"/",title:(0,i.jsxs)(y.A,{align:"center",gap:4,children:[(0,i.jsx)(v.A,{}),(0,i.jsx)("span",{children:(0,i.jsx)(o.A,{id:"link.home",children:"\u9996\u9875"})})]})},{title:(0,i.jsx)(o.A,{id:"link.myAccount",children:"\u7528\u6237\u4E2D\u5FC3"})}]})})}),(0,i.jsx)(j.A,{style:{borderRadius:n.borderRadiusLG,border:`1px solid ${n.colorBorderSecondary}`,boxShadow:n.boxShadowTertiary},title:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(P.A,{style:{color:n.colorPrimary}}),(0,i.jsx)(o.A,{id:"title.dataManagement",children:"\u6570\u636E\u7BA1\u7406"})]}),children:(0,i.jsxs)(u.A,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[(0,i.jsxs)(y.A,{justify:"space-between",align:"center",style:{padding:`${n.paddingSM}px 0`,borderBottom:`1px solid ${n.colorBorderSecondary}`},children:[(0,i.jsxs)(y.A,{align:"center",gap:n.marginMD,children:[(0,i.jsx)(A.A,{icon:(0,i.jsx)(S.A,{}),style:{backgroundColor:n.colorPrimaryBg,color:n.colorPrimary,border:`1px solid ${n.colorPrimaryBorder}`}}),(0,i.jsxs)("div",{children:[(0,i.jsx)($,{strong:!0,children:(0,i.jsx)(o.A,{id:"button.exportPrompts",children:"\u5BFC\u51FA\u63D0\u793A\u8BCD"})}),(0,i.jsx)("br",{}),(0,i.jsx)($,{type:"secondary",style:{fontSize:n.fontSizeSM},children:(0,i.jsx)(o.A,{id:"description.exportPrompts.short",children:"\u5BFC\u51FA\u4E3A JSON \u6587\u4EF6\uFF0C\u65B9\u4FBF\u5907\u4EFD"})})]})]}),(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(S.A,{}),onClick:Q,disabled:!e?.data?.items?.some(e=>"prompt"===e.type),children:(0,i.jsx)(o.A,{id:"button.export",children:"\u5BFC\u51FA\u6570\u636E"})})]}),(0,i.jsxs)(y.A,{justify:"space-between",align:"center",style:{padding:`${n.paddingSM}px 0`},children:[(0,i.jsxs)(y.A,{align:"center",gap:n.marginMD,children:[(0,i.jsx)(A.A,{icon:(0,i.jsx)(k.A,{}),style:{backgroundColor:n.colorPrimaryBg,color:n.colorPrimary,border:`1px solid ${n.colorPrimaryBorder}`}}),(0,i.jsxs)("div",{children:[(0,i.jsx)($,{strong:!0,children:(0,i.jsx)(o.A,{id:"button.clearCache",children:"\u6E05\u9664\u7F13\u5B58"})}),(0,i.jsx)("br",{}),(0,i.jsx)($,{type:"secondary",style:{fontSize:n.fontSizeSM},children:(0,i.jsx)(o.A,{id:"description.clearCache.short",children:"\u5237\u65B0\u672C\u5730\u7F13\u5B58\u6570\u636E"})})]})]}),(0,i.jsx)(w.A,{title:(0,i.jsx)(o.A,{id:"modal.clearCache.title",children:"\u786E\u8BA4\u6E05\u9664\u7F13\u5B58\uFF1F"}),description:(0,i.jsxs)("div",{children:[(0,i.jsx)($,{children:(0,i.jsx)(o.A,{id:"modal.clearCache.content",children:"\u7CFB\u7EDF\u4F7F\u7528 ETag \u6280\u672F\u81EA\u52A8\u7BA1\u7406\u7F13\u5B58\uFF0C\u901A\u5E38\u65E0\u9700\u624B\u52A8\u6E05\u9664\u3002"})}),(0,i.jsx)("br",{}),(0,i.jsx)($,{type:"warning",children:(0,i.jsx)(o.A,{id:"modal.clearCache.warning",children:"\u6E05\u9664\u540E\u5C06\u91CD\u65B0\u52A0\u8F7D\u6240\u6709\u6570\u636E\u3002"})})]}),onConfirm:X,okText:(0,i.jsx)(o.A,{id:"button.confirm",children:"\u786E\u8BA4\u6E05\u9664"}),okButtonProps:{danger:!0},cancelText:(0,i.jsx)(o.A,{id:"action.cancel",children:"\u53D6\u6D88"}),placement:"topRight",children:(0,i.jsx)(f.Ay,{danger:!0,icon:(0,i.jsx)(k.A,{}),children:(0,i.jsx)(o.A,{id:"button.clearAllCache",children:"\u6E05\u9664\u6240\u6709\u7F13\u5B58"})})})]})]})}),(0,i.jsxs)(x.A,{gutter:[24,24],children:[(0,i.jsx)(p.A,{xs:24,md:10,children:(0,i.jsx)(j.A,{style:{height:"100%",borderRadius:n.borderRadiusLG,border:`1px solid ${n.colorBorderSecondary}`,boxShadow:n.boxShadowTertiary},title:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(C.A,{style:{color:n.colorPrimary}}),(0,i.jsx)(o.A,{id:"title.userInfo",children:"\u7528\u6237\u4FE1\u606F"})]}),children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:24},children:[(0,i.jsx)(A.A,{size:96,icon:(0,i.jsx)(C.A,{}),style:{backgroundColor:n.colorPrimaryBg,color:n.colorPrimary,marginBottom:16,fontSize:40}}),J?(0,i.jsxs)(u.A.Compact,{style:{width:"100%",maxWidth:240},children:[(0,i.jsx)(b.A,{value:V,onChange:e=>W(e.target.value),onPressEnter:ee,autoFocus:!0}),(0,i.jsx)(f.Ay,{type:"primary",icon:(0,i.jsx)(B.A,{}),onClick:ee,loading:_}),(0,i.jsx)(f.Ay,{icon:(0,i.jsx)(R.A,{}),onClick:()=>N(!1)})]}):(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)(O,{level:4,style:{margin:0},children:L.username}),(0,i.jsx)(f.Ay,{type:"text",icon:(0,i.jsx)(R.A,{}),onClick:()=>{W(L?.username||""),N(!0)},size:"small",style:{color:n.colorTextSecondary}})]}),(0,i.jsxs)($,{type:"secondary",style:{marginTop:4},children:[(0,i.jsx)(z.A,{style:{marginRight:4}}),L.email]}),e?.data?.userprompts&&e.data.userprompts.filter(e=>e.share).length>0?(0,i.jsxs)(T.A,{color:"green",style:{marginTop:12},children:["\u{1F4DD} ",(0,i.jsx)(o.A,{id:"label.sharedPrompts",children:"\u5DF2\u5206\u4EAB\u63D0\u793A\u8BCD"}),": "+e.data.userprompts.filter(e=>e.share).length]}):(0,i.jsxs)(T.A,{color:"blue",style:{marginTop:12},children:["\u{1F331} ",(0,i.jsx)(o.A,{id:"label.newMember",children:"\u65B0\u6210\u5458\uFF0C\u5F00\u59CB\u5206\u4EAB\u7B2C\u4E00\u4E2A\u63D0\u793A\u8BCD\u5427"})]})]})})}),(0,i.jsx)(p.A,{xs:24,md:14,children:(0,i.jsx)(j.A,{style:{height:"100%",borderRadius:n.borderRadiusLG,border:`1px solid ${n.colorBorderSecondary}`,boxShadow:n.boxShadowTertiary},title:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(I.A,{style:{color:n.colorPrimary}}),(0,i.jsx)(o.A,{id:"title.security",children:"\u5B89\u5168\u8BBE\u7F6E"})]}),extra:(0,i.jsx)(f.Ay,{type:"link",onClick:()=>{s.confirm({title:(0,i.jsxs)(u.A,{children:[(0,i.jsx)(z.A,{style:{color:n.colorPrimary}}),(0,i.jsx)(o.A,{id:"modal.forgotPassword.title",children:"\u5FD8\u8BB0\u5BC6\u7801"})]}),icon:null,content:(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsx)($,{type:"secondary",style:{display:"block",marginBottom:16},children:(0,i.jsx)(o.A,{id:"message.forgotPassword.info",children:"\u6211\u4EEC\u4F1A\u5411\u60A8\u7684\u6CE8\u518C\u90AE\u7BB1\u53D1\u9001\u4E00\u5C01\u5305\u542B\u91CD\u7F6E\u94FE\u63A5\u7684\u90AE\u4EF6\u3002"})}),(0,i.jsx)(h.A,{form:Z,layout:"vertical",children:(0,i.jsx)(h.A.Item,{name:"email",label:(0,i.jsx)(o.A,{id:"placeholder.email",children:"\u90AE\u7BB1"}),rules:[{required:!0,message:(0,o.T)({id:"validation.email.required",message:"\u8BF7\u8F93\u5165\u60A8\u7684\u90AE\u7BB1\uFF01"})},{type:"email",message:(0,o.T)({id:"validation.email.invalid",message:"\u8BF7\u8F93\u5165\u6709\u6548\u7684\u90AE\u7BB1\u5730\u5740\uFF01"})}],initialValue:L?.email||"",children:(0,i.jsx)(b.A,{prefix:(0,i.jsx)(z.A,{style:{color:n.colorTextDescription}}),placeholder:(0,o.T)({id:"placeholder.email",message:"\u90AE\u7BB1"}),size:"large"})})})]}),onOk:async()=>{try{await Z.validateFields();let e=Z.getFieldsValue();await es(e)}catch(e){return Promise.reject(e)}},okText:(0,i.jsx)(o.A,{id:"action.sendResetEmail",children:"\u53D1\u9001\u91CD\u7F6E\u90AE\u4EF6"}),cancelText:(0,i.jsx)(o.A,{id:"action.cancel",children:"\u53D6\u6D88"}),centered:!0,width:480})},children:(0,i.jsx)(o.A,{id:"action.forgotPassword",children:"\u5FD8\u8BB0\u5BC6\u7801\uFF1F"})}),children:(0,i.jsxs)(h.A,{form:Y,onFinish:er,layout:"vertical",requiredMark:!1,children:[(0,i.jsx)(h.A.Item,{name:"currentPassword",label:(0,i.jsx)(o.A,{id:"placeholder.currentPassword",children:"\u5F53\u524D\u5BC6\u7801"}),rules:[{required:!0,message:(0,o.T)({id:"validation.currentPassword.required",message:"\u8BF7\u8F93\u5165\u5F53\u524D\u5BC6\u7801\uFF01"})}],children:(0,i.jsx)(b.A.Password,{prefix:(0,i.jsx)(E.A,{style:{color:n.colorTextDescription}}),placeholder:(0,o.T)({id:"placeholder.currentPassword",message:"\u5F53\u524D\u5BC6\u7801"}),size:"large"})}),(0,i.jsx)(h.A.Item,{name:"newPassword",label:(0,i.jsx)(o.A,{id:"placeholder.newPassword",children:"\u65B0\u5BC6\u7801"}),rules:[{required:!0,message:(0,o.T)({id:"input.newPassword",message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801\uFF01"})},{min:6,message:(0,o.T)({id:"validation.password.length",message:"\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11\u4E3A 6 \u4E2A\u5B57\u7B26"})}],children:(0,i.jsx)(b.A.Password,{prefix:(0,i.jsx)(E.A,{style:{color:n.colorTextDescription}}),placeholder:(0,o.T)({id:"placeholder.newPassword",message:"\u65B0\u5BC6\u7801"}),size:"large"})}),(0,i.jsx)(h.A.Item,{name:"confirmPassword",label:(0,i.jsx)(o.A,{id:"placeholder.confirmPassword",children:"\u786E\u8BA4\u65B0\u5BC6\u7801"}),dependencies:["newPassword"],rules:[{required:!0,message:(0,o.T)({id:"validation.confirmPassword.required",message:"\u8BF7\u786E\u8BA4\u65B0\u5BC6\u7801\uFF01"})},({getFieldValue:e})=>({validator:(r,s)=>s&&e("newPassword")!==s?Promise.reject(Error((0,o.T)({id:"validation.password.match",message:"\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4\uFF01"}))):Promise.resolve()})],children:(0,i.jsx)(b.A.Password,{prefix:(0,i.jsx)(E.A,{style:{color:n.colorTextDescription}}),placeholder:(0,o.T)({id:"placeholder.confirmPassword",message:"\u786E\u8BA4\u65B0\u5BC6\u7801"}),size:"large"})}),(0,i.jsx)(h.A.Item,{style:{marginBottom:0},children:(0,i.jsx)(f.Ay,{type:"primary",htmlType:"submit",loading:_,block:!0,size:"large",children:(0,i.jsx)(o.A,{id:"action.changePassword",children:"\u4FEE\u6539\u5BC6\u7801"})})})]})})})]})]})})})})})},U=()=>(0,i.jsx)(F.O,{children:(0,i.jsx)(d.A,{children:(0,i.jsx)(L,{})})})}}]);